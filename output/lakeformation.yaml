openapi: 3.0.0
info:
  title: LakeFormation
  version: 1.0.0
paths: {}
components:
  schemas:
    CatalogIdString:
      type: string
      minLength: 12
      maxLength: 12
    NameString:
      type: string
      minLength: 1
      maxLength: 255
    RowFilter:
      description: >-
        An object representing the Data Cells Filter's Row Filter. Either a
        Filter Expression or a Wildcard is required.
      type: object
      properties:
        FilterExpression:
          description: A PartiQL predicate.
          type: string
        AllRowsWildcard:
          description: An empty object representing a row wildcard.
          type: object
          additionalProperties: false
      additionalProperties: false
    ColumnNames:
      type: array
      items:
        $ref: '#/components/schemas/NameString'
      x-insertionOrder: false
    ColumnWildcard:
      type: object
      properties:
        ExcludedColumnNames:
          $ref: '#/components/schemas/ColumnNames'
      additionalProperties: false
    DataCellsFilter:
      type: object
      properties:
        TableCatalogId:
          description: The Catalog Id of the Table on which to create a Data Cells Filter.
          $ref: '#/components/schemas/CatalogIdString'
        DatabaseName:
          description: The name of the Database that the Table resides in.
          $ref: '#/components/schemas/NameString'
        TableName:
          description: The name of the Table to create a Data Cells Filter for.
          $ref: '#/components/schemas/NameString'
        Name:
          description: The desired name of the Data Cells Filter.
          $ref: '#/components/schemas/NameString'
        RowFilter:
          description: >-
            An object representing the Data Cells Filter's Row Filter. Either a
            Filter Expression or a Wildcard is required
          $ref: '#/components/schemas/RowFilter'
        ColumnNames:
          description: A list of columns to be included in this Data Cells Filter.
          $ref: '#/components/schemas/ColumnNames'
        ColumnWildcard:
          description: >-
            An object representing the Data Cells Filter's Columns. Either
            Column Names or a Wildcard is required
          $ref: '#/components/schemas/ColumnWildcard'
      required:
        - TableCatalogId
        - DatabaseName
        - TableName
        - Name
      x-stackql-resource-name: DataCellsFilter
    Admins:
      type: object
      additionalProperties: false
    DataLakeSettings:
      type: object
      properties:
        Admins:
          $ref: '#/components/schemas/Admins'
        TrustedResourceOwners:
          type: array
          uniqueItems: false
          items:
            type: string
        Id:
          type: string
      x-stackql-resource-name: DataLakeSettings
    DataLakePrincipal:
      type: object
      properties:
        DataLakePrincipalIdentifier:
          $ref: '#/components/schemas/DataLakePrincipalString'
      additionalProperties: false
    TableResource:
      type: object
      properties:
        CatalogId:
          $ref: '#/components/schemas/CatalogIdString'
        DatabaseName:
          $ref: '#/components/schemas/NameString'
        Name:
          $ref: '#/components/schemas/NameString'
        TableWildcard:
          $ref: '#/components/schemas/TableWildcard'
      required:
        - CatalogId
        - DatabaseName
      additionalProperties: false
    Resource:
      type: object
      properties:
        Catalog:
          $ref: '#/components/schemas/CatalogResource'
        Database:
          $ref: '#/components/schemas/DatabaseResource'
        Table:
          $ref: '#/components/schemas/TableResource'
        TableWithColumns:
          $ref: '#/components/schemas/TableWithColumnsResource'
      additionalProperties: false
    DatabaseResource:
      type: object
      properties:
        CatalogId:
          $ref: '#/components/schemas/CatalogIdString'
        Name:
          $ref: '#/components/schemas/NameString'
      required:
        - CatalogId
        - Name
      additionalProperties: false
    DataLocationResource:
      type: object
      properties:
        CatalogId:
          $ref: '#/components/schemas/CatalogIdString'
        ResourceArn:
          $ref: '#/components/schemas/ResourceArnString'
      additionalProperties: false
      required:
        - CatalogId
        - ResourceArn
    TableWildcard:
      type: object
      additionalProperties: false
    TableWithColumnsResource:
      type: object
      properties:
        CatalogId:
          $ref: '#/components/schemas/CatalogIdString'
        DatabaseName:
          $ref: '#/components/schemas/NameString'
        Name:
          $ref: '#/components/schemas/NameString'
        ColumnNames:
          $ref: '#/components/schemas/ColumnNames'
      required:
        - CatalogId
        - DatabaseName
        - Name
        - ColumnNames
      additionalProperties: false
    Permissions:
      type: object
      properties:
        Resource:
          $ref: '#/components/schemas/Resource'
        Permissions:
          type: array
          uniqueItems: false
          items:
            type: string
        Id:
          type: string
        DataLakePrincipal:
          $ref: '#/components/schemas/DataLakePrincipal'
        PermissionsWithGrantOption:
          type: array
          uniqueItems: false
          items:
            type: string
      required:
        - DataLakePrincipal
        - Resource
      x-stackql-resource-name: Permissions
    PathString:
      type: string
    ResourceArnString:
      type: string
    IAMRoleArn:
      type: string
      pattern: arn:*:iam::[0-9]*:role/.*
    LFTag:
      type: object
      properties:
        TagKey:
          $ref: '#/components/schemas/LFTagKey'
        TagValues:
          $ref: '#/components/schemas/TagValueList'
      additionalProperties: false
    LFTagPair:
      type: object
      properties:
        CatalogId:
          $ref: '#/components/schemas/CatalogIdString'
        TagKey:
          $ref: '#/components/schemas/LFTagKey'
        TagValues:
          $ref: '#/components/schemas/TagValueList'
      required:
        - CatalogId
        - TagKey
        - TagValues
      additionalProperties: false
    LFTagsList:
      type: array
      items:
        $ref: '#/components/schemas/LFTagPair'
      x-insertionOrder: false
    Expression:
      type: array
      x-insertionOrder: false
      items:
        $ref: '#/components/schemas/LFTag'
      minItems: 1
      maxItems: 5
    DataLakePrincipalString:
      type: string
      minLength: 1
      maxLength: 255
    ResourceType:
      type: string
      enum:
        - DATABASE
        - TABLE
    CatalogResource:
      type: object
      additionalProperties: false
    DataCellsFilterResource:
      type: object
      properties:
        TableCatalogId:
          $ref: '#/components/schemas/CatalogIdString'
        DatabaseName:
          $ref: '#/components/schemas/NameString'
        TableName:
          $ref: '#/components/schemas/NameString'
        Name:
          $ref: '#/components/schemas/NameString'
      additionalProperties: false
      required:
        - TableCatalogId
        - DatabaseName
        - TableName
        - Name
    LFTagKeyResource:
      type: object
      properties:
        CatalogId:
          $ref: '#/components/schemas/CatalogIdString'
        TagKey:
          $ref: '#/components/schemas/NameString'
        TagValues:
          $ref: '#/components/schemas/TagValueList'
      additionalProperties: false
      required:
        - CatalogId
        - TagKey
        - TagValues
    LFTagPolicyResource:
      type: object
      properties:
        CatalogId:
          $ref: '#/components/schemas/CatalogIdString'
        ResourceType:
          $ref: '#/components/schemas/ResourceType'
        Expression:
          $ref: '#/components/schemas/Expression'
      additionalProperties: false
      required:
        - CatalogId
        - ResourceType
        - Expression
    NullableBoolean:
      type:
        - boolean
        - 'null'
    Permission:
      type: string
      enum:
        - ALL
        - SELECT
        - ALTER
        - DROP
        - DELETE
        - INSERT
        - DESCRIBE
        - CREATE_DATABASE
        - CREATE_TABLE
        - DATA_LOCATION_ACCESS
        - CREATE_TAG
        - ASSOCIATE
    LFTagKey:
      type: string
      minLength: 1
      maxLength: 128
    LFTagValue:
      type: string
      minLength: 0
      maxLength: 256
    DataLakePrincipalList:
      type: array
      x-insertionOrder: false
      items:
        $ref: '#/components/schemas/DataLakePrincipal'
    PermissionList:
      type: array
      x-insertionOrder: false
      items:
        $ref: '#/components/schemas/Permission'
    TagValueList:
      type: array
      items:
        $ref: '#/components/schemas/LFTagValue'
      x-insertionOrder: false
      minItems: 1
      maxItems: 50
    PrincipalResourcePair:
      type: object
      properties:
        Principal:
          $ref: '#/components/schemas/DataLakePrincipal'
        Resource:
          $ref: '#/components/schemas/Resource'
      additionalProperties: false
      required:
        - Principal
        - Resource
    PrincipalPermissions:
      type: object
      properties:
        Catalog:
          $ref: '#/components/schemas/CatalogIdString'
        Principal:
          $ref: '#/components/schemas/DataLakePrincipal'
        Resource:
          $ref: '#/components/schemas/Resource'
        Permissions:
          $ref: '#/components/schemas/PermissionList'
        PermissionsWithGrantOption:
          $ref: '#/components/schemas/PermissionList'
        PrincipalIdentifier:
          type: string
        ResourceIdentifier:
          type: string
      required:
        - Principal
        - Resource
        - Permissions
        - PermissionsWithGrantOption
      x-stackql-resource-name: PrincipalPermissions
    PrincipalPermissionsList:
      type: array
      x-insertionOrder: false
      items:
        $ref: '#/components/schemas/PrincipalPermissions'
    Tag:
      type: object
      properties:
        CatalogId:
          description: >-
            The identifier for the Data Catalog. By default, the account ID. The
            Data Catalog is the persistent metadata store. It contains database
            definitions, table definitions, and other control information to
            manage your Lake Formation environment.
          $ref: '#/components/schemas/CatalogIdString'
        TagKey:
          description: The key-name for the LF-tag.
          $ref: '#/components/schemas/LFTagKey'
        TagValues:
          description: A list of possible values an attribute can take.
          $ref: '#/components/schemas/TagValueList'
      required:
        - TagKey
        - TagValues
      x-stackql-resource-name: Tag
    TagAssociation:
      type: object
      properties:
        Resource:
          description: Resource to tag with the Lake Formation Tags
          $ref: '#/components/schemas/Resource'
        LFTags:
          description: >-
            List of Lake Formation Tags to associate with the Lake Formation
            Resource
          $ref: '#/components/schemas/LFTagsList'
        ResourceIdentifier:
          description: >-
            Unique string identifying the resource. Used as primary identifier,
            which ideally should be a string
          type: string
        TagsIdentifier:
          description: >-
            Unique string identifying the resource's tags. Used as primary
            identifier, which ideally should be a string
          type: string
      required:
        - Resource
        - LFTags
      x-stackql-resource-name: TagAssociation
x-stackql-views:
  - DataCellsFilter:
      name: DataCellsFilter
      id: aws.lakeformation.DataCellsFilter
      config:
        views:
          select:
            predicate: sqlDialect == "sqlite3"
            ddl: >-
              SELECT 

              JSON_EXTRACT(Properties, '$.RowFilter.FilterExpression') as
              row_filter_filter_expression,

              JSON_EXTRACT(Properties, '$.RowFilter.AllRowsWildcard') as
              row_filter_all_rows_wildcard,

              JSON_EXTRACT(Properties, '$.ColumnWildcard.ExcludedColumnNames')
              as column_wildcard_excluded_column_names

              FROM aws.cloud_control.resources WHERE region = 'ap-southeast-1'
              and data__TypeName = 'AWS::LakeFormation::DataCellsFilter' ;
  - DataLakeSettings:
      name: DataLakeSettings
      id: aws.lakeformation.DataLakeSettings
      config:
        views:
          select:
            predicate: sqlDialect == "sqlite3"
            ddl: >-
              SELECT 

              JSON_EXTRACT(Properties, '$.TrustedResourceOwners') as
              trusted_resource_owners,

              JSON_EXTRACT(Properties, '$.Id') as id

              FROM aws.cloud_control.resources WHERE region = 'ap-southeast-1'
              and data__TypeName = 'AWS::LakeFormation::DataLakeSettings' ;
  - Permissions:
      name: Permissions
      id: aws.lakeformation.Permissions
      config:
        views:
          select:
            predicate: sqlDialect == "sqlite3"
            ddl: >-
              SELECT 

              JSON_EXTRACT(Properties, '$.Resource.Catalog') as
              resource_catalog,

              JSON_EXTRACT(Properties, '$.Resource.Database') as
              resource_database,

              JSON_EXTRACT(Properties, '$.Resource.Table') as resource_table,

              JSON_EXTRACT(Properties, '$.Resource.TableWithColumns') as
              resource_table_with_columns,

              JSON_EXTRACT(Properties, '$.Permissions') as permissions,

              JSON_EXTRACT(Properties, '$.Id') as id,

              JSON_EXTRACT(Properties,
              '$.DataLakePrincipal.DataLakePrincipalIdentifier') as
              data_lake_principal_data_lake_principal_identifier,

              JSON_EXTRACT(Properties, '$.PermissionsWithGrantOption') as
              permissions_with_grant_option

              FROM aws.cloud_control.resources WHERE region = 'ap-southeast-1'
              and data__TypeName = 'AWS::LakeFormation::Permissions' ;
  - PrincipalPermissions:
      name: PrincipalPermissions
      id: aws.lakeformation.PrincipalPermissions
      config:
        views:
          select:
            predicate: sqlDialect == "sqlite3"
            ddl: >-
              SELECT 

              JSON_EXTRACT(Properties,
              '$.Principal.DataLakePrincipalIdentifier') as
              principal_data_lake_principal_identifier,

              JSON_EXTRACT(Properties, '$.Resource.Catalog') as
              resource_catalog,

              JSON_EXTRACT(Properties, '$.Resource.Database') as
              resource_database,

              JSON_EXTRACT(Properties, '$.Resource.Table') as resource_table,

              JSON_EXTRACT(Properties, '$.Resource.TableWithColumns') as
              resource_table_with_columns,

              JSON_EXTRACT(Properties, '$.PrincipalIdentifier') as
              principal_identifier,

              JSON_EXTRACT(Properties, '$.ResourceIdentifier') as
              resource_identifier

              FROM aws.cloud_control.resources WHERE region = 'ap-southeast-1'
              and data__TypeName = 'AWS::LakeFormation::PrincipalPermissions' ;
  - Tag:
      name: Tag
      id: aws.lakeformation.Tag
      config:
        views:
          select:
            predicate: sqlDialect == "sqlite3"
            ddl: >-
              SELECT

              FROM aws.cloud_control.resources WHERE region = 'ap-southeast-1'
              and data__TypeName = 'AWS::LakeFormation::Tag' ;
  - TagAssociation:
      name: TagAssociation
      id: aws.lakeformation.TagAssociation
      config:
        views:
          select:
            predicate: sqlDialect == "sqlite3"
            ddl: >-
              SELECT 

              JSON_EXTRACT(Properties, '$.Resource.Catalog') as
              resource_catalog,

              JSON_EXTRACT(Properties, '$.Resource.Database') as
              resource_database,

              JSON_EXTRACT(Properties, '$.Resource.Table') as resource_table,

              JSON_EXTRACT(Properties, '$.Resource.TableWithColumns') as
              resource_table_with_columns,

              JSON_EXTRACT(Properties, '$.ResourceIdentifier') as
              resource_identifier,

              JSON_EXTRACT(Properties, '$.TagsIdentifier') as tags_identifier

              FROM aws.cloud_control.resources WHERE region = 'ap-southeast-1'
              and data__TypeName = 'AWS::LakeFormation::TagAssociation' ;
