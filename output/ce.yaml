openapi: 3.0.0
info:
  title: CE
  version: 1.0.0
paths: {}
components:
  schemas:
    Arn:
      description: Subscription ARN
      type: string
      pattern: ^arn:aws[-a-z0-9]*:[a-z0-9]+:[-a-z0-9]*:[0-9]{12}:[-a-zA-Z0-9/:_]+$
    ResourceTag:
      description: A key-value pair to associate with a resource.
      type: object
      additionalProperties: false
      properties:
        Key:
          type: string
          description: The key name for the tag.
          pattern: ^(?!aws:).*$
          minLength: 1
          maxLength: 128
        Value:
          type: string
          description: The value for the tag.
          minLength: 0
          maxLength: 256
      required:
        - Key
        - Value
    AnomalyMonitor:
      type: object
      properties:
        MonitorArn:
          $ref: '#/components/schemas/Arn'
        MonitorType:
          type: string
          enum:
            - DIMENSIONAL
            - CUSTOM
        MonitorName:
          description: The name of the monitor.
          type: string
          pattern: '[\S\s]*'
          minLength: 0
          maxLength: 1024
        CreationDate:
          description: 'The date when the monitor was created. '
          type: string
          minLength: 0
          maxLength: 40
          pattern: (\d{4}-\d{2}-\d{2})(T\d{2}:\d{2}:\d{2}Z)?
        LastEvaluatedDate:
          description: The date when the monitor last evaluated for anomalies.
          type: string
          minLength: 0
          maxLength: 40
          pattern: (\d{4}-\d{2}-\d{2})(T\d{2}:\d{2}:\d{2}Z)?
        LastUpdatedDate:
          description: The date when the monitor was last updated.
          type: string
          minLength: 0
          maxLength: 40
          pattern: (\d{4}-\d{2}-\d{2})(T\d{2}:\d{2}:\d{2}Z)?
        MonitorDimension:
          description: The dimensions to evaluate
          type: string
          enum:
            - SERVICE
        MonitorSpecification:
          type: string
        DimensionalValueCount:
          description: The value for evaluated dimensions.
          type: integer
          minimum: 0
        ResourceTags:
          type: array
          description: Tags to assign to monitor.
          items:
            $ref: '#/components/schemas/ResourceTag'
          minItems: 0
          maxItems: 200
          x-insertionOrder: false
      required:
        - MonitorName
        - MonitorType
      x-stackql-resource-name: AnomalyMonitor
    Subscriber:
      type: object
      properties:
        Address:
          type: string
          pattern: (^[a-zA-Z0-9.!#$%&'*+=?^_â€˜{|}~-]+@[a-zA-Z0-9_-]+(\.[a-zA-Z0-9_-]+)+$)|(^arn:(aws[a-zA-Z-]*):sns:[a-zA-Z0-9-]+:[0-9]{12}:[a-zA-Z0-9_-]+(\.fifo)?$)
        Status:
          type: string
          enum:
            - CONFIRMED
            - DECLINED
        Type:
          type: string
          enum:
            - EMAIL
            - SNS
      required:
        - Address
        - Type
      additionalProperties: false
    AnomalySubscription:
      type: object
      properties:
        SubscriptionArn:
          $ref: '#/components/schemas/Arn'
        SubscriptionName:
          description: The name of the subscription.
          type: string
          pattern: '[\S\s]*'
          minLength: 0
          maxLength: 1024
        AccountId:
          description: The accountId
          type: string
          minLength: 0
          maxLength: 1024
        MonitorArnList:
          description: A list of cost anomaly monitors.
          type: array
          x-insertionOrder: false
          items:
            $ref: '#/components/schemas/Arn'
        Subscribers:
          description: A list of subscriber
          type: array
          x-insertionOrder: false
          items:
            $ref: '#/components/schemas/Subscriber'
        Threshold:
          description: 'The dollar value that triggers a notification if the threshold is exceeded. '
          type: number
          minimum: 0
        ThresholdExpression:
          description: An Expression object in JSON String format used to specify the anomalies that you want to generate alerts for.
          type: string
        Frequency:
          description: 'The frequency at which anomaly reports are sent over email. '
          type: string
          enum:
            - DAILY
            - IMMEDIATE
            - WEEKLY
        ResourceTags:
          type: array
          description: Tags to assign to subscription.
          items:
            $ref: '#/components/schemas/ResourceTag'
          minItems: 0
          maxItems: 200
          x-insertionOrder: false
      required:
        - MonitorArnList
        - Subscribers
        - Frequency
        - SubscriptionName
      x-stackql-resource-name: AnomalySubscription
    ZonedDateTime:
      description: ISO 8601 date time with offset format
      type: string
      pattern: ^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(([+-]\d\d:\d\d)|Z)$
      minLength: 20
      maxLength: 25
    CostCategory:
      type: object
      properties:
        Arn:
          description: Cost category ARN
          type: string
          pattern: ^arn:aws[-a-z0-9]*:[a-z0-9]+:[-a-z0-9]*:[0-9]{12}:[-a-zA-Z0-9/:_]+$
        EffectiveStart:
          $ref: '#/components/schemas/ZonedDateTime'
        Name:
          type: string
          minLength: 1
          maxLength: 50
        RuleVersion:
          type: string
          enum:
            - CostCategoryExpression.v1
        Rules:
          type: string
          description: JSON array format of Expression in Billing and Cost Management API
        SplitChargeRules:
          type: string
          description: Json array format of CostCategorySplitChargeRule in Billing and Cost Management API
        DefaultValue:
          type: string
          description: The default value for the cost category
          minLength: 1
          maxLength: 50
      required:
        - Name
        - RuleVersion
        - Rules
      x-stackql-resource-name: CostCategory
    ExpiryEventsConfiguration:
      type: object
      additionalProperties: false
      properties:
        DaysBeforeExpiry:
          type: integer
          minimum: 1
          maximum: 45
    AccountId:
      type: string
    Account:
      type: object
      properties:
        ExpiryEventsConfiguration:
          $ref: '#/components/schemas/ExpiryEventsConfiguration'
        AccountId:
          $ref: '#/components/schemas/AccountId'
      required:
        - ExpiryEventsConfiguration
      x-stackql-resource-name: Account
    DomainValidationOption:
      type: object
      additionalProperties: false
      properties:
        DomainName:
          type: string
        ValidationDomain:
          type: string
        HostedZoneId:
          type: string
      required:
        - DomainName
    Tag:
      type: object
      additionalProperties: false
      properties:
        Value:
          type: string
        Key:
          type: string
      required:
        - Value
        - Key
    Certificate:
      type: object
      properties:
        CertificateAuthorityArn:
          type: string
        DomainValidationOptions:
          type: array
          uniqueItems: true
          items:
            $ref: '#/components/schemas/DomainValidationOption'
        CertificateTransparencyLoggingPreference:
          type: string
        DomainName:
          type: string
        ValidationMethod:
          type: string
        SubjectAlternativeNames:
          type: array
          uniqueItems: true
          items:
            type: string
        Id:
          type: string
        Tags:
          type: array
          uniqueItems: false
          items:
            $ref: '#/components/schemas/Tag'
      required:
        - DomainName
      x-stackql-resource-name: Certificate
x-stackql-views:
  - AnomalyMonitor:
      name: AnomalyMonitor
      id: aws.ce.AnomalyMonitor
      config:
        views:
          select:
            predicate: sqlDialect == "sqlite3"
            ddl: |-
              SELECT
              JSON_EXTRACT(Properties, '$.MonitorType') as monitor_type,
              JSON_EXTRACT(Properties, '$.MonitorName') as monitor_name,
              JSON_EXTRACT(Properties, '$.CreationDate') as creation_date,
              JSON_EXTRACT(Properties, '$.LastEvaluatedDate') as last_evaluated_date,
              JSON_EXTRACT(Properties, '$.LastUpdatedDate') as last_updated_date,
              JSON_EXTRACT(Properties, '$.MonitorDimension') as monitor_dimension,
              JSON_EXTRACT(Properties, '$.MonitorSpecification') as monitor_specification,
              JSON_EXTRACT(Properties, '$.DimensionalValueCount') as dimensional_value_count,
              JSON_EXTRACT(Properties, '$.ResourceTags') as resource_tags
              FROM aws.cloud_control.resources WHERE region = 'ap-southeast-1' and data__TypeName = 'AWS::CE::AnomalyMonitor' ;
  - AnomalySubscription:
      name: AnomalySubscription
      id: aws.ce.AnomalySubscription
      config:
        views:
          select:
            predicate: sqlDialect == "sqlite3"
            ddl: |-
              SELECT
              JSON_EXTRACT(Properties, '$.SubscriptionName') as subscription_name,
              JSON_EXTRACT(Properties, '$.AccountId') as account_id,
              JSON_EXTRACT(Properties, '$.MonitorArnList') as monitor_arn_list,
              JSON_EXTRACT(Properties, '$.Subscribers') as subscribers,
              JSON_EXTRACT(Properties, '$.Threshold') as threshold,
              JSON_EXTRACT(Properties, '$.ThresholdExpression') as threshold_expression,
              JSON_EXTRACT(Properties, '$.Frequency') as frequency,
              JSON_EXTRACT(Properties, '$.ResourceTags') as resource_tags
              FROM aws.cloud_control.resources WHERE region = 'ap-southeast-1' and data__TypeName = 'AWS::CE::AnomalySubscription' ;
  - CostCategory:
      name: CostCategory
      id: aws.ce.CostCategory
      config:
        views:
          select:
            predicate: sqlDialect == "sqlite3"
            ddl: |-
              SELECT
              JSON_EXTRACT(Properties, '$.Arn') as arn,
              JSON_EXTRACT(Properties, '$.Name') as name,
              JSON_EXTRACT(Properties, '$.RuleVersion') as rule_version,
              JSON_EXTRACT(Properties, '$.Rules') as rules,
              JSON_EXTRACT(Properties, '$.SplitChargeRules') as split_charge_rules,
              JSON_EXTRACT(Properties, '$.DefaultValue') as default_value
              FROM aws.cloud_control.resources WHERE region = 'ap-southeast-1' and data__TypeName = 'AWS::CE::CostCategory' ;
  - Account:
      name: Account
      id: aws.ce.Account
      config:
        views:
          select:
            predicate: sqlDialect == "sqlite3"
            ddl: |-
              SELECT
              JSON_EXTRACT(Properties, '$.ExpiryEventsConfiguration.DaysBeforeExpiry') as expiry_events_configuration_days_before_expiry
              FROM aws.cloud_control.resources WHERE region = 'ap-southeast-1' and data__TypeName = 'AWS::CE::Account' ;
  - Certificate:
      name: Certificate
      id: aws.ce.Certificate
      config:
        views:
          select:
            predicate: sqlDialect == "sqlite3"
            ddl: |-
              SELECT
              JSON_EXTRACT(Properties, '$.CertificateAuthorityArn') as certificate_authority_arn,
              JSON_EXTRACT(Properties, '$.DomainValidationOptions') as domain_validation_options,
              JSON_EXTRACT(Properties, '$.CertificateTransparencyLoggingPreference') as certificate_transparency_logging_preference,
              JSON_EXTRACT(Properties, '$.DomainName') as domain_name,
              JSON_EXTRACT(Properties, '$.ValidationMethod') as validation_method,
              JSON_EXTRACT(Properties, '$.SubjectAlternativeNames') as subject_alternative_names,
              JSON_EXTRACT(Properties, '$.Id') as id,
              JSON_EXTRACT(Properties, '$.Tags') as tags
              FROM aws.cloud_control.resources WHERE region = 'ap-southeast-1' and data__TypeName = 'AWS::CE::Certificate' ;
