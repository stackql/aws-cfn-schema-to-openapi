openapi: 3.0.0
info:
  title: Macie
  version: 1.0.0
paths: {}
components:
  schemas:
    Regex:
      type: string
    S3WordsList:
      type: object
      properties:
        BucketName:
          type: string
        ObjectKey:
          type: string
      required:
        - BucketName
        - ObjectKey
      additionalProperties: false
    Criteria:
      description: The regex or s3 object to use for the AllowList.
      type: object
      oneOf:
        - additionalProperties: false
          properties:
            Regex:
              type: string
              description: The S3 object key for the AllowList.
          required:
            - Regex
        - additionalProperties: false
          properties:
            S3WordsList:
              $ref: '#/components/schemas/S3WordsList'
              description: The S3 location for the AllowList.
          required:
            - S3WordsList
    Status:
      description: The status for the AllowList
      type: string
      enum:
        - OK
        - S3_OBJECT_NOT_FOUND
        - S3_USER_ACCESS_DENIED
        - S3_OBJECT_ACCESS_DENIED
        - S3_THROTTLED
        - S3_OBJECT_OVERSIZE
        - S3_OBJECT_EMPTY
        - UNKNOWN_ERROR
    Tag:
      description: A key-value pair to associate with a resource.
      type: object
      properties:
        Key:
          type: string
          description: The tag's key.
        Value:
          type: string
          description: The tag's value.
      required:
        - Value
        - Key
      additionalProperties: false
    AllowList:
      type: object
      properties:
        Name:
          description: Name of AllowList.
          type: string
          x-is-top-level-property: true
        Description:
          description: Description of AllowList.
          type: string
          x-is-top-level-property: true
        Criteria:
          description: AllowList criteria.
          $ref: '#/components/schemas/Criteria'
          x-is-top-level-property: true
        Id:
          description: AllowList ID.
          type: string
          x-is-top-level-property: true
        Arn:
          description: AllowList ARN.
          type: string
          x-is-top-level-property: true
        Status:
          description: AllowList status.
          $ref: '#/components/schemas/Status'
          x-is-top-level-property: true
        Tags:
          description: A collection of tags associated with a resource
          type: array
          x-insertionOrder: false
          items:
            $ref: '#/components/schemas/Tag'
          x-is-top-level-property: true
      required:
        - Name
        - Criteria
      x-stackql-resource-name: AllowList
    CustomDataIdentifier:
      type: object
      properties:
        Name:
          description: Name of custom data identifier.
          type: string
          x-is-top-level-property: true
        Description:
          description: Description of custom data identifier.
          type: string
          x-is-top-level-property: true
        Regex:
          description: Regular expression for custom data identifier.
          type: string
          x-is-top-level-property: true
        MaximumMatchDistance:
          description: Maximum match distance.
          type: integer
          x-is-top-level-property: true
        Keywords:
          description: Keywords to be matched against.
          type: array
          items:
            type: string
          x-is-top-level-property: true
        IgnoreWords:
          description: Words to be ignored.
          type: array
          items:
            type: string
          x-is-top-level-property: true
        Id:
          description: Custom data identifier ID.
          type: string
          x-is-top-level-property: true
        Arn:
          description: Custom data identifier ARN.
          type: string
          x-is-top-level-property: true
      required:
        - Name
        - Regex
      x-stackql-resource-name: CustomDataIdentifier
    CriterionAdditionalProperties:
      type: object
      properties:
        gt:
          type: integer
          format: int64
        gte:
          type: integer
          format: int64
        lt:
          type: integer
          format: int64
        lte:
          type: integer
          format: int64
        eq:
          type: array
          items:
            type: string
        neq:
          type: array
          items:
            type: string
    Criterion:
      description: Map of filter criteria.
      type: object
      x-patternProperties:
        \w:
          $ref: '#/components/schemas/CriterionAdditionalProperties'
    FindingCriteria:
      type: object
      properties:
        Criterion:
          $ref: '#/components/schemas/Criterion'
    FindingFilterAction:
      type: string
      enum:
        - ARCHIVE
        - NOOP
    FindingsFilterListItem:
      description: Returned by ListHandler representing filter name and ID.
      type: object
      properties:
        Id:
          type: string
        Name:
          type: string
    FindingsFilter:
      type: object
      properties:
        Name:
          description: Findings filter name
          type: string
          x-is-top-level-property: true
        Description:
          description: Findings filter description
          type: string
          x-is-top-level-property: true
        FindingCriteria:
          description: Findings filter criteria.
          $ref: '#/components/schemas/FindingCriteria'
          x-is-top-level-property: true
        Action:
          description: Findings filter action.
          $ref: '#/components/schemas/FindingFilterAction'
          x-is-top-level-property: true
        Position:
          description: Findings filter position.
          type: integer
          x-is-top-level-property: true
        Id:
          description: Findings filter ID.
          type: string
          x-is-top-level-property: true
        Arn:
          description: Findings filter ARN.
          type: string
          x-is-top-level-property: true
        FindingsFilterListItems:
          description: Findings filters list.
          type: array
          items:
            $ref: '#/components/schemas/FindingsFilterListItem'
          x-is-top-level-property: true
      required:
        - Name
        - FindingCriteria
      x-stackql-resource-name: FindingsFilter
    Session:
      type: object
      properties:
        AwsAccountId:
          description: AWS account ID of customer
          type: string
          x-is-top-level-property: true
        Status:
          description: A enumeration value that specifies the status of the Macie Session.
          type: string
          enum:
            - ENABLED
            - PAUSED
          default: ENABLED
          x-is-top-level-property: true
        FindingPublishingFrequency:
          description: >-
            A enumeration value that specifies how frequently finding updates
            are published.
          type: string
          enum:
            - FIFTEEN_MINUTES
            - ONE_HOUR
            - SIX_HOURS
          default: SIX_HOURS
          x-is-top-level-property: true
        ServiceRole:
          description: Service role used by Macie
          type: string
          x-is-top-level-property: true
      required: []
      x-stackql-resource-name: Session
x-stackql-views:
  - AllowList:
      name: AllowList
      id: aws.macie.AllowList
      config:
        views:
          select:
            predicate: sqlDialect == "sqlite3"
            ddl: >-
              SELECT 

              JSON_EXTRACT(Properties, '$.Name') as name,

              JSON_EXTRACT(Properties, '$.Description') as description,

              JSON_EXTRACT(Properties, '$.Id') as id,

              JSON_EXTRACT(Properties, '$.Arn') as arn,

              JSON_EXTRACT(Properties, '$.Tags') as tags

              FROM aws.cloud_control.resources WHERE region = 'ap-southeast-1'
              and data__TypeName = 'AWS::Macie::AllowList' ;
  - CustomDataIdentifier:
      name: CustomDataIdentifier
      id: aws.macie.CustomDataIdentifier
      config:
        views:
          select:
            predicate: sqlDialect == "sqlite3"
            ddl: >-
              SELECT 

              JSON_EXTRACT(Properties, '$.Name') as name,

              JSON_EXTRACT(Properties, '$.Description') as description,

              JSON_EXTRACT(Properties, '$.Regex') as regex,

              JSON_EXTRACT(Properties, '$.MaximumMatchDistance') as
              maximum_match_distance,

              JSON_EXTRACT(Properties, '$.Keywords') as keywords,

              JSON_EXTRACT(Properties, '$.IgnoreWords') as ignore_words,

              JSON_EXTRACT(Properties, '$.Id') as id,

              JSON_EXTRACT(Properties, '$.Arn') as arn

              FROM aws.cloud_control.resources WHERE region = 'ap-southeast-1'
              and data__TypeName = 'AWS::Macie::CustomDataIdentifier' ;
  - FindingsFilter:
      name: FindingsFilter
      id: aws.macie.FindingsFilter
      config:
        views:
          select:
            predicate: sqlDialect == "sqlite3"
            ddl: >-
              SELECT 

              JSON_EXTRACT(Properties, '$.Name') as name,

              JSON_EXTRACT(Properties, '$.Description') as description,

              JSON_EXTRACT(Properties, '$.FindingCriteria.Criterion') as
              finding_criteria_criterion,

              JSON_EXTRACT(Properties, '$.Position') as position,

              JSON_EXTRACT(Properties, '$.Id') as id,

              JSON_EXTRACT(Properties, '$.Arn') as arn,

              JSON_EXTRACT(Properties, '$.FindingsFilterListItems') as
              findings_filter_list_items

              FROM aws.cloud_control.resources WHERE region = 'ap-southeast-1'
              and data__TypeName = 'AWS::Macie::FindingsFilter' ;
  - Session:
      name: Session
      id: aws.macie.Session
      config:
        views:
          select:
            predicate: sqlDialect == "sqlite3"
            ddl: >-
              SELECT 

              JSON_EXTRACT(Properties, '$.AwsAccountId') as aws_account_id,

              JSON_EXTRACT(Properties, '$.Status') as status,

              JSON_EXTRACT(Properties, '$.FindingPublishingFrequency') as
              finding_publishing_frequency,

              JSON_EXTRACT(Properties, '$.ServiceRole') as service_role

              FROM aws.cloud_control.resources WHERE region = 'ap-southeast-1'
              and data__TypeName = 'AWS::Macie::Session' ;
